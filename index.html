<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tango Logic Puzzle - å°ˆæ¥­ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #1a1a2e;
            --card-bg: #16213e;
            --cell-bg: #0f3460;
            --cell-fixed: #1a1a2e;
            --primary: #e94560;
            --yellow: #f1c40f;
            --blue: #3498db;
            --text: #e2e2e2;
            --error: #ff4757;
        }

        body {
            font-family: 'Segoe UI', "Microsoft JhengHei", sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin: 10px 0; letter-spacing: 5px; color: var(--primary); }

        .level-select { margin-bottom: 20px; }
        button {
            padding: 8px 16px;
            margin: 0 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: var(--cell-bg);
            color: white;
            transition: 0.3s;
        }
        button:hover { background: var(--primary); }
        button.active { background: var(--primary); font-weight: bold; }

        /* éŠæˆ²ä¸»é¢æ¿ - 11x11 ç¶²æ ¼ç³»çµ± (6æ ¼ + 5å€‹ç¬¦è™Ÿé–“éš™) */
        .board {
            display: grid;
            grid-template-columns: repeat(6, 60px 20px); /* 60px æ ¼å­, 20px ç¬¦è™Ÿé–“éš™ */
            grid-template-columns: 60px 25px 60px 25px 60px 25px 60px 25px 60px 25px 60px;
            grid-template-rows: 60px 25px 60px 25px 60px 25px 60px 25px 60px 25px 60px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            user-select: none;
        }

        /* æ ¼å­æ¨£å¼ */
        .cell {
            width: 60px;
            height: 60px;
            background: var(--cell-bg);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        .cell.fixed { background: var(--cell-fixed); cursor: default; }
        .cell:hover:not(.fixed) { transform: scale(1.05); filter: brightness(1.2); }

        /* éŒ¯èª¤åµæ¸¬æ¨£å¼ */
        .error-line { border-color: var(--error) !important; background: rgba(255, 71, 87, 0.1); }
        .cell.conflict { animation: shake 0.4s; border: 2px solid var(--error); }

        /* ç´„æŸç¬¦è™Ÿæ¨£å¼ (ç­‰æ–¼ã€å‰å‰) */
        .symbol {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--text);
            opacity: 0.6;
        }

        .status-msg { height: 30px; margin-top: 15px; font-weight: bold; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .victory-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--primary); padding: 30px 50px; border-radius: 20px;
            text-align: center; display: none; z-index: 100; box-shadow: 0 0 50px rgba(233, 69, 96, 0.5);
        }
    </style>
</head>
<body>

    <h1>TANGO</h1>

    <div class="level-select" id="levelButtons">
        <button onclick="loadLevel(0)" class="active">åŸºç¤ç·´ç¿’</button>
        <button onclick="loadLevel(1)">é‚è¼¯é€²éš</button>
        <button onclick="loadLevel(2)">å°ˆå®¶æŒ‘æˆ°</button>
    </div>

    <div class="board" id="board"></div>

    <div class="status-msg" id="statusMsg">é»æ“Šæ ¼å­å¡«å…¥ ğŸŸ¡ æˆ– ğŸ”·</div>

    <div class="victory-modal" id="winMessage">
        <h2>å¤ªæ£’äº†ï¼</h2>
        <p>ä½ å®Œç¾è§£æ±ºäº†é€™é“è¬é¡Œ</p>
        <button onclick="closeWin()" style="background: white; color: var(--primary);">ç¹¼çºŒä¸‹ä¸€é—œ</button>
    </div>

<script>
    const GRID_SIZE = 6;
    // é¡Œåº«è³‡æ–™
    const levels = [
        {
            name: "åŸºç¤ç·´ç¿’",
            fixed: [[0,0,1], [0,5,2], [2,2,1], [5,5,1]], // [r, c, type] 1:ğŸŸ¡, 2:ğŸ”·
            hSigns: [{r:0, c:2, type:'='}, {r:4, c:0, type:'x'}],
            vSigns: [{r:1, c:4, type:'='}, {r:3, c:1, type:'x'}]
        },
        {
            name: "é‚è¼¯é€²éš",
            fixed: [[1,1,2], [1,4,1], [4,1,1], [4,4,2]],
            hSigns: [{r:0, c:0, type:'='}, {r:2, c:4, type:'='}, {r:5, c:2, type:'x'}],
            vSigns: [{r:0, c:3, type:'x'}, {r:4, c:0, type:'='}]
        },
        {
            name: "å°ˆå®¶æŒ‘æˆ°",
            fixed: [[0,3,1], [5,2,2]],
            hSigns: [{r:0, c:0, type:'x'}, {r:1, c:2, type:'='}, {r:3, c:4, type:'x'}, {r:5, c:0, type:'='}],
            vSigns: [{r:0, c:5, type:'x'}, {r:2, c:0, type:'='}, {r:4, c:3, type:'x'}]
        }
    ];

    let currentLevelIdx = 0;
    let boardState = Array(6).fill().map(() => Array(6).fill(0));
    let fixedMask = Array(6).fill().map(() => Array(6).fill(false));

    function initBoardUI() {
        const boardEl = document.getElementById('board');
        boardEl.innerHTML = '';
        
        // ç”Ÿæˆ 11x11 çš„æ ¼å­èˆ‡é–“éš™
        for (let r = 0; r < 11; r++) {
            for (let c = 0; c < 11; c++) {
                const isCell = r % 2 === 0 && c % 2 === 0;
                const div = document.createElement('div');
                
                if (isCell) {
                    const row = r / 2;
                    const col = c / 2;
                    div.className = 'cell';
                    div.id = `cell-${row}-${col}`;
                    div.onclick = () => handleCellClick(row, col);
                } else {
                    div.className = 'symbol';
                    div.id = `sym-${r}-${c}`;
                }
                boardEl.appendChild(div);
            }
        }
    }

    function loadLevel(idx) {
        currentLevelIdx = idx;
        const level = levels[idx];
        
        // é‡ç½®ç‹€æ…‹
        boardState = Array(6).fill().map(() => Array(6).fill(0));
        fixedMask = Array(6).fill().map(() => Array(6).fill(false));
        
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('.level-select button').forEach((btn, i) => {
            btn.className = i === idx ? 'active' : '';
        });

        // å¡«å…¥å›ºå®šæ ¼
        level.fixed.forEach(([r, c, type]) => {
            boardState[r][c] = type;
            fixedMask[r][c] = true;
        });

        render();
    }

    function handleCellClick(r, c) {
        if (fixedMask[r][c]) return;
        boardState[r][c] = (boardState[r][c] + 1) % 3;
        render();
        checkWin();
    }

    function render() {
        // æ¸…é™¤æ‰€æœ‰éŒ¯èª¤æ¨£å¼
        document.querySelectorAll('.cell').forEach(el => el.classList.remove('conflict', 'error-line'));
        
        // æ¸²æŸ“æ ¼å­
        for (let r = 0; r < 6; r++) {
            for (let c = 0; c < 6; c++) {
                const el = document.getElementById(`cell-${r}-${c}`);
                const val = boardState[r][c];
                el.innerText = val === 1 ? 'ğŸŸ¡' : (val === 2 ? 'ğŸ”·' : '');
                el.classList.toggle('fixed', fixedMask[r][c]);
            }
        }

        // æ¸²æŸ“ç¬¦è™Ÿ
        const level = levels[currentLevelIdx];
        level.hSigns.forEach(s => {
            const el = document.getElementById(`sym-${s.r*2}-${s.c*2+1}`);
            el.innerText = s.type === '=' ? '=' : 'Ã—';
        });
        level.vSigns.forEach(s => {
            const el = document.getElementById(`sym-${s.r*2+1}-${s.c*2}`);
            el.innerText = s.type === '=' ? 'â€–' : 'Ã—'; // å‚ç›´å‘ç”¨é›™ç·šè¡¨ç¤ºç­‰æ–¼
        });

        validate();
    }

    function validate() {
        let errors = new Set();

        // 1. æª¢æŸ¥ä¸‰é€£ (åˆ—èˆ‡è¡Œ)
        for (let i = 0; i < 6; i++) {
            for (let j = 0; j < 4; j++) {
                // æ©«å‘
                if (boardState[i][j] !== 0 && boardState[i][j] === boardState[i][j+1] && boardState[i][j] === boardState[i][j+2]) {
                    [0,1,2].forEach(k => errors.add(`${i}-${j+k}`));
                }
                // ç¸±å‘
                if (boardState[j][i] !== 0 && boardState[j][i] === boardState[j+1][i] && boardState[j][i] === boardState[j+2][i]) {
                    [0,1,2].forEach(k => errors.add(`${j+k}-${i}`));
                }
            }
        }

        // 2. æª¢æŸ¥æ•¸é‡å¹³è¡¡ (å¦‚æœè¶…é 3 å€‹å°±å ±éŒ¯)
        for (let i = 0; i < 6; i++) {
            let rCount = [0, 0, 0], cCount = [0, 0, 0];
            for (let j = 0; j < 6; j++) {
                rCount[boardState[i][j]]++;
                cCount[boardState[j][i]]++;
            }
            if (rCount[1] > 3 || rCount[2] > 3) highlightLine(i, 'row');
            if (cCount[1] > 3 || cCount[2] > 3) highlightLine(i, 'col');
        }

        // 3. æª¢æŸ¥ç´„æŸç¬¦è™Ÿ
        const level = levels[currentLevelIdx];
        level.hSigns.forEach(s => {
            const v1 = boardState[s.r][s.c], v2 = boardState[s.r][s.c+1];
            if (v1 !== 0 && v2 !== 0) {
                if ((s.type === '=' && v1 !== v2) || (s.type === 'x' && v1 === v2)) {
                    errors.add(`${s.r}-${s.c}`); errors.add(`${s.r}-${s.c+1}`);
                }
            }
        });
        level.vSigns.forEach(s => {
            const v1 = boardState[s.r][s.c], v2 = boardState[s.r+1][s.c];
            if (v1 !== 0 && v2 !== 0) {
                if ((s.type === '=' && v1 !== v2) || (s.type === 'x' && v1 === v2)) {
                    errors.add(`${s.r}-${s.c}`); errors.add(`${s.r+1}-${s.c}`);
                }
            }
        });

        errors.forEach(key => {
            document.getElementById(`cell-${key}`).classList.add('conflict');
        });
    }

    function highlightLine(idx, type) {
        for (let i = 0; i < 6; i++) {
            const id = type === 'row' ? `cell-${idx}-${i}` : `cell-${i}-${idx}`;
            document.getElementById(id).classList.add('error-line');
        }
    }

    function checkWin() {
        // æª¢æŸ¥æ˜¯å¦å¡«æ»¿ä¸”ç„¡éŒ¯èª¤
        let filled = true;
        for(let r=0; r<6; r++) {
            for(let c=0; c<6; c++) { if(boardState[r][c] === 0) filled = false; }
        }
        if(!filled) return;

        // å†æ¬¡è·‘ä¸€æ¬¡å®Œæ•´é©—è­‰ç¢ºä¿æ²’ conflict
        const hasConflict = document.querySelector('.conflict') || document.querySelector('.error-line');
        if (filled && !hasConflict) {
            triggerWin();
        }
    }

    function triggerWin() {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#f1c40f', '#3498db', '#e94560']
        });
        document.getElementById('winMessage').style.display = 'block';
    }

    function closeWin() {
        document.getElementById('winMessage').style.display = 'none';
        if (currentLevelIdx < levels.length - 1) loadLevel(currentLevelIdx + 1);
    }

    // åˆå§‹åŒ–
    initBoardUI();
    loadLevel(0);
</script>
</body>
</html>
